<form [formGroup]="myForm">
  <div
    class="col-md-12 p-1 alert alert-success"
    role="alert"
    *ngIf="dataLoaded && statementList.length > 0"
  >
    <span *ngIf="dataLoaded && statementList.length > 0"
      >***** Pagos fijos periodo {{ formattedPeriod }}*****</span
    >

    <div *ngFor="let statement of statementList" class="item">
      &nbsp;&nbsp;<span class="description"
        >==> {{ statement.description }}</span
      >&nbsp;<span class="value">{{
        statement.value | currency : "PEN" : "symbol" : "1.2-2"
      }}</span>
    </div>

    <br />
    <span *ngIf="dataLoaded && statementList[0].amount > 0"
      >***** Desglose del prestamo *****</span
    >
    <div *ngIf="dataLoaded && statementList[0].amount > 0">
      &nbsp;&nbsp;==> Monto total del prestamo:
      {{ statementList[0].amount | currency : "PEN" : "symbol" : "1.2-2" }}
    </div>
    <div *ngIf="dataLoaded && statementList[0].amount > 0">
      &nbsp;&nbsp;==> Número de cuotas del prestamo:
      {{ statementList[0].feeCount }}
    </div>
    <div *ngIf="dataLoaded && statementList[0].amount > 0">
      &nbsp;&nbsp;==> Número de cuota a pagar: {{ statementList[0].feeNumber }}
    </div>
    <div *ngIf="dataLoaded && statementList[0].amount > 0">
      &nbsp;&nbsp;==> Monto de la cuota:
      {{ statementList[0].feeAmount | currency : "PEN" : "symbol" : "1.2-2" }}
    </div>
    <div *ngIf="dataLoaded && statementList[0].amount > 0">
      &nbsp;&nbsp;==> Total a pagar:
      {{ statementList[0].totalPay | currency : "PEN" : "symbol" : "1.2-2" }}
    </div>
  </div>

  <div class="row" *ngIf="dataLoaded && statementList.length > 0">
    <div class="col-md-2">
      <div class="form-group">
        <label>Ingrese monto:</label>
        <input
          type="number"
          class="form-control col-md-12"
          placeholder="ingrese monto"
          formControlName="amountToPay"
        />
      </div>
    </div>
    <div class="col-md-2">
      <br />
      <button type="button" class="btn btn-primary mr-1" (click)="onPay()">
        <i class="fas fa-save"></i> Registrar pago
      </button>
    </div>
  </div>
  <br />
  <div
    class="col-md-12 p-1 alert alert-success"
    role="alert"
    *ngIf="dataLoaded && statementList[0].amount == 0"
  >
    <span>***** Socio no registra prestamo. *****</span>
  </div>
  <div class="row" *ngIf="dataLoaded && statementList[0].amount > 0">
    <div class="col-md-7">
      <h4>Listado de cuotas</h4>
      <div class="table-responsive table-dark">
        <table class="table table-striped table-bordered text-nowrap">
          <thead class="alert alert-info">
            <tr>
              <th>Item</th>
              <th>Fecha pago</th>
              <th>Saldo inicial</th>
              <th>Interes</th>
              <th>Amortización</th>
              <th>Cuota - saldo</th>
              <th>Saldo final</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let feeSchedule of feeScheduleList">
              <td>{{ feeSchedule.feeNumber }}</td>
              <td>{{ feeSchedule.feeDate }}</td>
              <td>
                {{
                  feeSchedule.initialBalance
                    | currency : "PEN" : "symbol" : "1.2-2"
                }}
              </td>
              <td>
                {{
                  feeSchedule.interestAmount
                    | currency : "PEN" : "symbol" : "1.2-2"
                }}
              </td>
              <td>
                {{
                  feeSchedule.amortization
                    | currency : "PEN" : "symbol" : "1.2-2"
                }}
              </td>
              <td>
                <ng-container
                  *ngIf="
                    feeSchedule.amountToPay > 0 &&
                      feeSchedule.feeAmount - feeSchedule.amountToPay > 0;
                    else noBalance
                  "
                >
                  {{
                    feeSchedule.feeAmount
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}-{{
                    feeSchedule.feeAmount - feeSchedule.amountToPay
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}
                </ng-container>
                <ng-template #noBalance>{{
                  feeSchedule.feeAmount | currency : "PEN" : "symbol" : "1.2-2"
                }}</ng-template>
              </td>
              <td>
                {{
                  feeSchedule.endBalance | currency : "PEN" : "symbol" : "1.2-2"
                }}
              </td>
              <td>{{ feeSchedule.paidDetail }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <strong>Deuda actual:</strong>
      {{ totalDifference.toFixed(2) | currency : "PEN" : "symbol" : "1.2-2" }}
    </div>
    <div class="col-md-5" *ngIf="dataLoaded && loanHistorylist.length > 0">
      <h4>Historial del prestamo</h4>
      <div class="table-responsive table-dark">
        <table class="table table-striped table-bordered text-nowrap">
          <thead class="alert alert-info">
            <tr>
              <th>Fecha</th>
              <th>Descripción</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let loanHistory of loanHistorylist">
              <td>{{ loanHistory.creationDate }}</td>
              <td>{{ loanHistory.description }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</form>
