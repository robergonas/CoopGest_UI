<form [formGroup]="myForm">
  <div class="row">
    <div class="col-md-4 p-1">
      <div class="form-group">
        <label>Socio</label>
        <select
          class="form-select con-md-12"
          (change)="onSelectPartner($event)"
          formControlName="idPartner"
        >
          <option [value]="0" selected>Seleccione ...</option>
          <option
            *ngFor="let partner of partnerList"
            [value]="partner.idPartner"
          >
            {{ partner.name }}
          </option>
        </select>
      </div>
    </div>
    <div class="col-md-2 p-1">
      <br />
      <button
        class="btn btn-secondary"
        (click)="onDownloadCreditReport()"
        *ngIf="dataLoaded && feeScheduleList.length > 0"
      >
        <i class="fa-solid fa-file-pdf pl-2 text-decoration-none"></i>
        Descargar
      </button>
    </div>
  </div>
  <br />
  <div class="row" *ngIf="dataLoaded && loanList.length > 0">
    <div class="col.md-12 p-1">
      <h4>Historial del socio</h4>
      <div class="table-responsive table-dark">
        <table class="table table-striped table-bordered text-nowrap">
          <thead class="alert alert-info">
            <tr>
              <th>Código</th>
              <th>monto</th>
              <th>Interes</th>
              <th>Cuotas</th>
              <th>Fecha aprobación</th>
              <th>Estado</th>
              <th>Usuario aprobador</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let loan of loanList">
              <td
                (click)="onGetDetailLoan(loan.idLoan)"
                class="cursor-pointer text-decoration-underline"
              >
                {{ loan.idLoan }}
              </td>
              <td class="d-flex justify-content-center align-items-center">
                {{ loan.amount | currency : "PEN" : "symbol" : "1.2-2" }}
              </td>
              <td>{{ loan.interestRate }}%</td>
              <td>{{ loan.feeCount }}</td>
              <td>{{ loan.creationDate }}</td>
              <td>{{ loan.active ? "Pendiente" : "Pagado" }}</td>
              <td>{{ loan.userCreation }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div
    class="col-md-12 p-1 alert alert-success"
    role="alert"
    *ngIf="dataLoaded && loanList.length == 0"
  >
    <span>***** Socio no registra prestamo. *****</span>
  </div>
  <div #creditReport *ngIf="dataLoaded && feeScheduleList.length > 0">
    <body>
      <div class="row">
        <div class="text-start">COOPERATIVA DE AHORRO Y CREDITO MI FAMILIA</div>
        <div class="d-flex justify-content-center align-items-center h2">
          REPORTE CREDITICIO
        </div>
      </div>
      <div class="row">
        <div class="col-md-1"><strong>Socio:</strong></div>
        <div class="col-md-2">{{ selectdLoan?.partner }}</div>
        <div class="col-md-1">
          <strong>{{ selectdLoan?.documentType }}:</strong>
        </div>
        <div class="col-md-2">{{ selectdLoan?.documentNumber }}</div>
        <div class="col-md-1"><strong>Teléfono:</strong></div>
        <div class="col-md-2">{{ selectdLoan?.phoneNumber }}</div>
      </div>
      <div class="row">
        <div class="col-md-1"><strong>Correo:</strong></div>
        <div class="col-md-2">{{ selectdLoan?.email }}</div>
        <div class="col-md-1"><strong>Dirección:</strong></div>
        <div class="col-md-8">{{ selectdLoan?.address }}</div>
      </div>
      <div class="row">
        <div class="col-md-1"><strong>Código:</strong></div>
        <div class="col-md-2">{{ selectdLoan?.idLoan }}</div>
        <div class="col-md-1"><strong>Monto:</strong></div>
        <div class="col-md-2">
          {{ selectdLoan?.amount | currency : "PEN" : "symbol" : "1.2-2" }}
        </div>
        <div class="col-md-1"><strong>Aprobado el:</strong></div>
        <div class="col-md-2">{{ selectdLoan?.creationDate }}</div>
        <div class="col-md-1"><strong>Estado:</strong></div>
        <div class="col-md-2">
          {{ selectdLoan?.active ? "Pendiente" : "Pagado" }}
        </div>
      </div>
      <br />
      <div class="col-md-12 p-1">
        <h4>Lista de cuotas</h4>
        <div class="table-responsive table-dark">
          <table class="table table-striped table-bordered text-nowrap">
            <thead class="alert alert-info">
              <tr>
                <th>Item</th>
                <th>Fecha pago</th>
                <th>Saldo inicial</th>
                <th>Interes</th>
                <th>Amortización</th>
                <th>Cuota - saldo</th>
                <th>Saldo final</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let feeSchedule of feeScheduleList">
                <td>{{ feeSchedule.feeNumber }}</td>
                <td>{{ feeSchedule.feeDate }}</td>
                <td>
                  {{
                    feeSchedule.initialBalance
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}
                </td>
                <td>
                  {{
                    feeSchedule.interestAmount
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}
                </td>
                <td>
                  {{
                    feeSchedule.amortization
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}
                </td>
                <td>
                  <ng-container
                    *ngIf="
                      feeSchedule.amountToPay > 0 &&
                        feeSchedule.feeAmount - feeSchedule.amountToPay > 0;
                      else noBalance
                    "
                  >
                    {{
                      feeSchedule.feeAmount
                        | currency : "PEN" : "symbol" : "1.2-2"
                    }}
                    -
                    {{
                      feeSchedule.feeAmount - feeSchedule.amountToPay
                        | currency : "PEN" : "symbol" : "1.2-2"
                    }}
                  </ng-container>
                  <ng-template #noBalance>{{
                    feeSchedule.feeAmount
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}</ng-template>
                </td>
                <td>
                  {{
                    feeSchedule.endBalance
                      | currency : "PEN" : "symbol" : "1.2-2"
                  }}
                </td>
                <td>{{ feeSchedule.paidDetail }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="totalDifference > 0">
          <strong>Deuda actual:</strong
          >{{
            totalDifference.toFixed(2) | currency : "PEN" : "symbol" : "1.2-2"
          }}
        </div>
      </div>
      <br />
      <div class="col-md-12 p-1">
        <h4>Historial del prestamo</h4>
        <div class="table-responsive table-dark">
          <table class="table table-striped table-bordered">
            <thead class="alert alert-info">
              <tr>
                <th>Fecha</th>
                <th>Descripción</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let loanHistory of loanHistoryList">
                <td>{{ loanHistory.creationDate }}</td>
                <td>{{ loanHistory.description }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </body>
  </div>
</form>
